<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{general/plantilla :: head}"></head>
<body>
<div th:replace="~{general/plantilla :: header}"></div>

<div class="container mt-4">
    <div class="d-flex justify-content-between mb-3">
        <h3>Libros</h3>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalAgregar">Agregar libro</button>
    </div>

    <div th:replace="~{general/plantilla :: toast}"></div>

    <div class="card mb-3">
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Título</th>
                    <th>Autor</th>
                    <th>Categoría</th>
                    <th>Disponible</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="l : ${libros}">
                    <td th:text="${l.id}">1</td>
                    <td th:text="${l.titulo}">Título</td>
                    <td th:text="${l.autor}">Autor</td>
                    <td th:text="${l.categoria.nombre}">Categoría</td>
                    <td th:text="${l.disponible} ? 'Sí' : 'No'">Sí</td>
                    <td>
                        <a th:href="@{/libro/modificar/{id}(id=${l.id})}" class="btn btn-warning btn-sm">Editar</a>
                        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmModal"
                                th:attr="data-id=${l.id}, data-titulo=${l.titulo}">Eliminar</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="modal fade" id="modalAgregar" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form th:action="@{/libro/guardar}" th:object="${libro}" method="post" enctype="multipart/form-data">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="modal-header">
                        <h5 class="modal-title">Agregar libro</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3"><label>Título</label><input class="form-control" th:field="*{titulo}" required/></div>
                        <div class="mb-3"><label>Autor</label><input class="form-control" th:field="*{autor}" required/></div>
                        <div class="mb-3">
                            <label>Categoría</label>
                            <select class="form-select" th:field="*{categoria}" required>
                                <option th:each="c : ${categorias}" th:value="${c}" th:text="${c.nombre}"></option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label>Imagen portada</label>
                            <input class="form-control" type="file" name="imagenFile" accept="image/*" onchange="mostrarImagen(this)"/>
                            <img class="preview-img mt-2" src="#" alt="preview" style="max-height:200px; display:none;"/>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form th:action="@{/libro/eliminar}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" id="modalId" name="id"/>
                    <div class="modal-header">
                        <h5 class="modal-title">Confirmar eliminación</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>¿Desea eliminar el libro <strong id="modalTitulo"></strong>?</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger" type="submit">Eliminar</button>
                        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<div th:replace="~{general/plantilla :: footer}"></div>
</body>
</html>